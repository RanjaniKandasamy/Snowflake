--select role and warehouse
use role accountadmin;
use warehouse compute_wh;

--create database and schema
create or replace database ttips;
create or replace schema ch01;

-- create a customer table under ttips.ch01
-- it is a transient table which contains 15 fields and datatypes
-- like varchar, number, decimal, boolean, date and timestamp

create or replace transient table customer_csv(
customer_pk integer,
salutation varchar(10),
first_name varchar(20),
last_name varchar(30),
gender varchar(1),
marital_status varchar(1),
day_of_birth date,
birth_country varchar(60),
email_address varchar(50),
city_name varchar(60),
zip_code varchar(10),
country_name varchar(20),
gmt_timezone_offset number(10,2),
preferred_cust_flag boolean,
registration_time timestamp_ltz(9)
);

-- create a file format to parse the flat file data
-- type is csv, compression is none, field_delimiter is comma, skipping header

create or replace file format customer_csv_ff
 type = 'csv'
 compression = 'none'
 field_delimiter = ','
 skip_header = 1 ;

 -- Try to load data from the csv file to Snowflake using Load Data button
 -- use Show SQL button to know whether the file will be purged after loading or not
 -- change on_error field to continue 
 
 -- current version of snowflake
 select current_version(), current_region();

 
 select * from ttips.information_schema.load_history;
 -- check the first error message field

 -- Snowflake file format has this feature to recognize double quotes inside the data 
 -- field_optionally_enclosed_by = '\042'
 -- for single quote it is field_optionally_enclosed_by = '\027'
 -- creating another file format to take in the double quote input
 create or replace file format customer_csv_ff2
 type = 'csv'
 compression = 'none'
 field_delimiter = ','
 field_optionally_enclosed_by = '\042'
 skip_header = 1 ;
 
-- before loading data to the customer table lets first truncate the existing dataset
truncate table customer_csv;

--select count(*) from customer_csv;

--try loading the data again. This time it should work.
